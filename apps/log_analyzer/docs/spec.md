## 概要

C:\Users\USER\Desktop\FXlog\logs
上記フォルダ内に、ヤフー掲示板のドル円スレのログをjsonl形式で保存しています
これらのログを大衆の意見として参考にして、レスの内容を生成AIによって解釈し、逆のポジションを取るBOTを作成したいです。


## UI上でユーザーが期間指定
まず、解釈作業を行う期間については、UI上で日単位でカレンダーから選択する形で
開始期間、終了期間をそれぞれ指定する形でお願いします

また、「土日は除外」のチェックをONにする事で、
月曜日の午前7時～土曜日の午前6:59の範囲外のレスを排除するようにしてください
（デフォルトON）

## 該当部分の抽出
C:\Users\USER\Desktop\FXlog\logs
上記フォルダに存在する各jsonlファイルの内容は、下記のようになっています。

{"comment_no": 4577, "comment_id": "10342809", "user_id": "c98d9a46ed657fd0a2a8b443c771027644ee02c8c35a7955996eaab1eacbdaab", "posted_at": "2026年1月16日 23:59", "text": "俺の鼓動がうずき始めている", "part": 3291} {"comment_no": 4576, "comment_id": "10342808", "user_id": "5f0a0855b1c709459e7d79ea2dc603adcd74f9bf749b75bacb7b36df9d85da19", "posted_at": "2026年1月16日 23:59", "text": "考えるな、感じろ", "part": 3291} {"comment_no": 4575, "comment_id": "10342807", "user_id": "1460f2838b882d4ccc44b6e552d4fba65d68a01876d3c506f4733fbd16a7d5db", "posted_at": "2026年1月16日 23:59", "text": "日足半値戻しやね", "part": 3291}

これらを生成AIに解釈させるにあたって、
・レスの日時
・レスの本文
以外の要素は一切不要です。（生成AIに全文渡すのはトークン数を無駄に消耗してしまいます）

ですので例えば上記のレスの場合は

26-01-16 23:59	俺の鼓動がうずき始めている
26-01-16 23:59	考えるな、感じろ
26-01-16 23:59	日足半値戻しやね

上記のように、まず各レスを省略する仕組みを実装してください。（2000年以前のデータを渡す事はないので年部分については2026年の場合は26といったように下2桁でOK）

##　当時のレートも同時に渡す
例えばレスの内容が「158.80までいってほしい」という内容だったとします
この場合、その時点のレートがわからないと、そのレスの主が上がってほしいと思っているのか、下がってほしいと思っているのかどちらなのかがわかりません。
この対策として、下記の実装をお願いします。

C:\Users\USER\Desktop\FXlog\data\usdjpy
上記フォルダにUSDJPYの1分足のOHLCデータを保存しています
上記データを参考に、それぞれのレス時点のUSDJPYの始値を3列目のデータとして追記して渡すようにしてください

2026-01-16 23:59	俺の鼓動がうずき始めている	157.907
2026-01-16 23:59	考えるな、感じろ	157.907
2026-01-16 23:59	日足半値戻しやね	157.907

レス時点のドル円レートも生成AIに渡す事で、解釈の精度をより高める事が狙いです。

## 何レスずつ解釈させるか
生成AIに解釈作業を行わせるにあたって、1レスずつ渡すのはトークン量を大きく消耗する事になります
ですので、「1回ごとに何レスずつ生成AIに渡すか？」という設定をUI上で入力可能にしてください
また、デフォルトは「20レスずつ」としてください

##　生成AIに解釈させる仕組み
ここまでの各レスの短縮作業が終わったら、API経由でGeminiに解釈作業を行わせます。

C:\Users\USER\Desktop\FXlog\prompt.txt
まだ未完成ですが、プロンプトファイルは現状上記に保存していますので、一例として内容を確認しておいてください。
prompt.mdファイルを直接編集する事によって、そのプロンプトに従って生成AIが各レスを解釈するような仕組みにしてほしいです。
（一旦現存するprompt.txtの内容をそのままコピーしてmdファイルとして適切な保管場所に設置してください。）

GeminiをAPIキーで使用し、3.0Flashモデルのバッチ版を使用して解釈し、売買サイン化します。
(APIキーについては.envファイルを用意する)

## CSVとして出力
先述した形式でレス内容をGeminiに渡すことによって、promptの指示通り1レス＝1行に変換した下記のような回答が返ってきます
26.01.16 00:04,S,I,,fear
26.01.16 00:05,B,L,158.80,tp_plan
26.01.16 00:07,S,I,,boast|greed

各列はそれぞれ
1列目：売買日時
2列目：ロングorショート（BUY or SELLをB or Sの1文字に省略）
3列目：即時エントリーor指値（INSTANT or LIMITをI or Lの1文字に省略）
4列目：指値の場合のレート（4列目がLの場合のみ入力。3列目がIの場合は空欄）
5列目以降：エントリー理由（例の3行目のように、複数の場合は縦線(|)区切りで入力）
以上を意味します

そして受け取った行を下記のフォーマット例に合わせて
1日ごとに1ファイルのCSVファイルとして生成します。

datetime,,side,entry_type,entry_price,reason
26.01.16 00:04,S,I,,fear
26.01.16 00:05,B,L,158.80,tp_plan
26.01.16 00:07,S,I,,boast|greed

CSVのファイル名は「usdjpy_20260116.csv」といったファイル名でお願いします

生成したCSVファイルは
C:\Users\USER\Desktop\FXlog\csv
上記のフォルダに生成してください
